let paso=1,max_paso=3,min_paso=1,servicios=[],serviciosSeleccionados=[],cita={id:"",fecha:"",hora:"",idUsuario:"",servicios:[]};document.addEventListener("DOMContentLoaded",()=>{consultarAPI(),cambiarPagina(),paginaciones(),botonesCambiadores(),paginaAnterior(),paginaSiguiente(),insertarIdUsuario(),insertarNombre(),insertarFecha(),insertarHora(),informacionResumen()});const mainServicios=document.querySelector(".main-servicios"),informacionCita=document.querySelector(".informacion-cita"),resumen=document.querySelector(".resumen"),paginadores=document.querySelectorAll(".nav-cita input");function informacionResumen(){for(;resumen.hasChildNodes();)resumen.removeChild(resumen.lastChild);if(""===cita.fecha||""===cita.hora||0===cita.servicios.length)return void mensajeAlerta("FaltÃ³ agregar un servicio o llenar los campos de formulario","error",resumen,!1);let{fecha:e,hora:a,servicios:o}=cita;const i=document.createElement("DIV"),n=document.createElement("H2");n.textContent="Resumen Servicios",i.appendChild(n),resumen.appendChild(i),o.forEach(e=>{nombre=document.createElement("P"),precio=document.createElement("P"),nombre.innerHTML="<span>Nombre: </span> "+e.nombre,precio.innerHTML="<span>Precio: </span> "+e.costo+" $",contenedorServicio=document.createElement("DIV"),contenedorServicio.appendChild(nombre),contenedorServicio.appendChild(precio),contenedorServicio.classList.add("contenedor-servicio"),i.appendChild(contenedorServicio)}),crearInformacionCita()}function crearInformacionCita(){division_cita=document.createElement("DIV"),titulo_cita=document.createElement("H2"),division_cita.appendChild(titulo_cita),titulo_cita.textContent="Resumen Cita",resumen.appendChild(division_cita),fechaCita=document.createElement("P"),horaCita=document.createElement("P"),division_cita.classList.add("contenedor-servicio"),fechaCita.innerHTML="<span>Fecha: </span> "+cita.fecha,horaCita.innerHTML="<span>Hora: </span> "+cita.hora,division_cita.appendChild(fechaCita),division_cita.appendChild(horaCita);const e=document.createElement("input");e.type="button",e.value="Crear Cita",e.classList.add("boton-azul"),e.onclick=function(){postEnviarDatos()},resumen.appendChild(e)}async function postEnviarDatos(){let e=new FormData,{fecha:a,hora:o,servicios:i,idUsuario:n}=cita;servicios_id=[],i.forEach(e=>{servicios_id.push(e.id)}),e.append("fecha",a),e.append("hora",o),e.append("servicios",servicios_id),e.append("id_usuario",n),console.log(n),url="http://localhost:8000/API/cita",e.append("nombre","juan"),envioDatos=await fetch(url,{method:"POST",body:e}),resultadoDatos=await envioDatos.json(),console.log(resultadoDatos)}function insertarIdUsuario(){let e=document.querySelector("#id_usuario");cita.idUsuario=e.value}function insertarHora(){let e=document.querySelector("#hora");e.addEventListener("input",()=>{cita.hora=e.value})}function insertarNombre(){let e=document.querySelector("#nombre");cita.nombre=e.value}function insertarFecha(){let e=document.querySelector("#fecha");e.addEventListener("input",a=>{fechaComprobar=new Date(a.target.value),[0,6].includes(fechaComprobar.getUTCDay())?(cita.fecha="",e.value="",mensajeAlerta("No se puede agendar Sabados o Domingos","error",informacionCita,!0)):cita.fecha=a.target.value})}function mensajeAlerta(e,a,o,i){const n=document.createElement("P");n.classList.add("alerta",a),n.textContent=e,o.appendChild(n),i&&setTimeout(()=>{n.remove()},3e3)}async function consultarAPI(){let e=await fetch("http://localhost:8000/API/servicios"),a=await e.json();servicios=[...a],crearElementos(servicios)}function seleccionados(e,a){cita.servicios.some(a=>a.id===e.id)?(posicionEliminar=cita.servicios.indexOf(e),cita.servicios.splice(posicionEliminar,1)):cita.servicios.push(e),!1===a.selected?(a.classList.add("seleccionado"),a.lastChild.classList.add("blanco"),a.selected=!0):(a.classList.remove("seleccionado"),a.lastChild.classList.remove("blanco"),a.selected=!1)}function crearElementos(e){let a=document.querySelector(".contenedor-servicios");e.forEach(e=>{const o=document.createElement("DIV"),i=document.createElement("P"),n=document.createElement("P");i.textContent=e.nombre+" $",n.textContent=e.costo+" $",i.classList.add("servicios__nombre"),n.classList.add("servicios__precio"),o.classList.add("servicios"),o.selected=!1,o.onclick=function(){seleccionados(e,o)},o.appendChild(i),o.appendChild(n),a.appendChild(o)})}function paginaAnterior(){document.querySelector(".boton-anterior").addEventListener("click",e=>{paso>min_paso&&(paso-=1,cambiarPagina(),botonesCambiadores())})}function paginaSiguiente(){document.querySelector(".boton-siguiente").addEventListener("click",e=>{paso<max_paso&&(paso+=1,cambiarPagina(),botonesCambiadores())})}function botonesCambiadores(){const e=document.querySelector(".boton-anterior"),a=document.querySelector(".boton-siguiente");1===paso?(e.classList.add("nover"),a.classList.remove("nover")):2===paso?(e.classList.remove("nover"),a.classList.remove("nover")):(e.classList.remove("nover"),a.classList.add("nover"))}function paginaciones(){paginadores.forEach(e=>{e.addEventListener("click",e=>{paso=parseInt(e.target.attributes.page_data.value),cambiarPagina(),botonesCambiadores()})})}function cambiarPagina(){1===paso?(mainServicios.classList.add("mostrar"),informacionCita.classList.remove("mostrar"),resumen.classList.remove("mostrar"),paginadores[0].classList.add("cambiarBlanco"),paginadores[1].classList.remove("cambiarBlanco"),paginadores[2].classList.remove("cambiarBlanco")):2===paso?(mainServicios.classList.remove("mostrar"),informacionCita.classList.add("mostrar"),resumen.classList.remove("mostrar"),paginadores[0].classList.remove("cambiarBlanco"),paginadores[1].classList.add("cambiarBlanco"),paginadores[2].classList.remove("cambiarBlanco")):(mainServicios.classList.remove("mostrar"),informacionCita.classList.remove("mostrar"),resumen.classList.add("mostrar"),paginadores[0].classList.remove("cambiarBlanco"),paginadores[1].classList.remove("cambiarBlanco"),paginadores[2].classList.add("cambiarBlanco"),informacionResumen())}